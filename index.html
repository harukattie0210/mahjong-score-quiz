<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>éº»é›€ ç‚¹æ•°è¨ˆç®—ã‚¯ã‚¤ã‚ºï¼ˆç”»åƒã¤ãï¼‰</title>
  <style>
    :root { font-family: system-ui, -apple-system, "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif; }
    body { margin: 0; background:#f6f7fb; color:#111; }
    .wrap { max-width: 980px; margin: 0 auto; padding: 20px; }
    .card { background:#fff; border-radius: 14px; padding: 18px; box-shadow: 0 6px 18px rgba(0,0,0,.06); }
    h1 { font-size: 20px; margin: 0 0 12px; }
    .row { display:flex; gap: 12px; flex-wrap: wrap; align-items: center; }
    .badge { display:inline-block; padding: 6px 10px; border-radius: 999px; background:#eef2ff; font-weight: 800; }
    .meta { color:#555; font-size: 13px; }
    input[type="text"]{
      width: min(420px, 100%);
      padding: 12px 12px;
      font-size: 18px;
      border-radius: 10px;
      border: 1px solid #d7dbe7;
      outline: none;
    }
    input[type="text"]:focus { border-color: #6b7cff; box-shadow: 0 0 0 3px rgba(107,124,255,.15); }
    button{
      padding: 11px 14px;
      border: 0; border-radius: 10px;
      font-weight: 800; font-size: 15px;
      cursor: pointer;
      background:#111; color:#fff;
    }
    button.secondary { background:#e9edf7; color:#111; }
    button:disabled { opacity:.55; cursor:not-allowed; }
    .ok { color:#0b7a3a; font-weight: 900; }
    .ng { color:#b00020; font-weight: 900; }

    .grid { display:grid; grid-template-columns: 1fr; gap: 12px; }
    @media (min-width: 900px){
      .grid { grid-template-columns: 1.35fr .65fr; }
    }

    .handBox{
      display:flex; gap:12px; flex-wrap:wrap; align-items:flex-start;
      margin-top: 10px;
    }
    .handImgWrap{
      width: min(620px, 100%);
      background:#fafbff;
      border:1px solid #eef0f6;
      border-radius: 12px;
      padding: 10px;
    }
    .handImg{
      width: 100%;
      height: auto;
      border-radius: 10px;
      display:block;
    }
    .handFallback{
      border-radius: 10px;
      padding: 14px;
      background:#0b1020;
      color:#d7e0ff;
      font-size: 22px;
      line-height: 1.6;
      word-break: break-word;
    }
    .sideInfo{
      min-width: 240px;
      flex: 1;
      background:#fafbff;
      border:1px solid #eef0f6;
      border-radius: 12px;
      padding: 12px;
    }
    .kv{ display:flex; justify-content:space-between; gap:10px; padding:6px 0; border-bottom:1px dashed #e6e9f3;}
    .kv:last-child{ border-bottom:0; }
    .k{ color:#666; font-weight: 700; }
    .v{ font-weight: 900; }
    .hint{ margin-top:10px; font-size: 12px; color:#666; }
    details { margin-top: 12px; }
    summary { cursor: pointer; font-weight: 900; }
    pre { white-space:pre-wrap; margin:10px 0 0; background:#0b1020; color:#d7e0ff; padding:12px; border-radius:12px; overflow:auto; }

    .log { max-height: 280px; overflow: auto; border:1px solid #eef0f6; border-radius: 10px; padding: 10px; background:#fafbff; }
    .log-item { border-bottom:1px dashed #e6e9f3; padding: 8px 2px; }
    .log-item:last-child { border-bottom:0; }
    .small { font-size: 12px; color:#666; }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; background:#f1f3f9; padding:2px 6px; border-radius: 6px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="grid">
      <div class="card">
        <h1>éº»é›€ ç‚¹æ•°è¨ˆç®—ã‚¯ã‚¤ã‚ºï¼ˆç”»åƒã¤ããƒ»ç‚¹æ•°å½“ã¦ï¼‰</h1>

        <div class="row meta">
          <span class="badge">ãƒªãƒ¼ãƒéº»é›€ / èµ¤ã‚ã‚Š</span>
          <span>ä¾›è¨—ï¼š0ã€€æœ¬å ´ï¼š0ï¼ˆå›ºå®šï¼‰</span>
          <span>ã‚¹ã‚³ã‚¢ï¼š<b id="score">0</b> / <b id="total">0</b></span>
          <span>é€£ç¶šæ­£è§£ï¼š<b id="streak">0</b></span>
        </div>

        <div class="handBox">
          <div class="handImgWrap">
            <img id="handImg" class="handImg" alt="æ‰‹ç‰Œç”»åƒ" style="display:none;" />
            <div id="handFallback" class="handFallback" style="display:none;"></div>
          </div>

          <div class="sideInfo">
            <div class="kv"><div class="k">å ´</div><div class="v" id="roundWind">æ±å ´</div></div>
            <div class="kv"><div class="k">è¦ª/å­</div><div class="v" id="dealerOrChild">å­</div></div>
            <div class="kv"><div class="k">ã‚ãŒã‚Š</div><div class="v" id="winType">ãƒ­ãƒ³</div></div>
            <div class="kv"><div class="k">ãƒ‰ãƒ©è¡¨ç¤º</div><div class="v" id="doraIndicator">ğŸ€™</div></div>

            <div class="hint">
              å…¥åŠ›ãƒ«ãƒ¼ãƒ«ï¼š<br>
              ãƒ­ãƒ³ã¯æ•°å­—1ã¤ï¼ˆä¾‹ <span class="kbd">3900</span>ï¼‰<br>
              å­ãƒ„ãƒ¢ã¯ <span class="kbd">è¦ª/å­</span>ï¼ˆä¾‹ <span class="kbd">2000/1000</span>ï¼‰<br>
              è¦ªãƒ„ãƒ¢ã¯ <span class="kbd">2000ã‚ªãƒ¼ãƒ«</span>ï¼ˆ<span class="kbd">2000all</span> ã§ã‚‚OKï¼‰
            </div>
          </div>
        </div>

        <div class="row" style="margin-top:12px;">
          <input
            id="answer"
            type="text"
            inputmode="numeric"
            pattern="[0-9/]*"
            autocomplete="off"
            autocorrect="off"
            autocapitalize="off"
            spellcheck="false"
            placeholder="ä¾‹ï¼š3900 / 2000/1000 / 2000ã‚ªãƒ¼ãƒ«"
          />
          <button id="submitBtn">ç­”ãˆã‚‹ï¼ˆEnterï¼‰</button>
          <button class="secondary" id="nextBtn" disabled>æ¬¡ã¸</button>
          <button class="secondary" id="resetBtn" title="ã‚¹ã‚³ã‚¢ã¨å±¥æ­´ã‚’ãƒªã‚»ãƒƒãƒˆ">ãƒªã‚»ãƒƒãƒˆ</button>
        </div>

        <div id="result" style="margin-top:12px;"></div>

        <details id="detailBox" style="display:none;">
          <summary>è¨ˆç®—éç¨‹ã‚’è¦‹ã‚‹</summary>
          <pre id="detail"></pre>
        </details>

        <div class="small" style="margin-top:10px;">
          â€»ç”»åƒã¯è¡¨ç¤ºç”¨ã§ã™ã€‚ç‚¹æ•°æ¡ç‚¹ã¯å†…éƒ¨ã®ã€Œç¬¦ãƒ»ç¿»ï¼ˆå•é¡Œãƒ‡ãƒ¼ã‚¿ï¼‰ã€ã¨ã€Œè¦ªå­/ãƒ„ãƒ¢ãƒ­ãƒ³ã€ã«åŸºã¥ãã¾ã™ã€‚<br>
          â€»æ±å ´/å—å ´ã¯å‡ºé¡ŒçŠ¶æ³ã¨ã—ã¦è¡¨ç¤ºã—ã¾ã™ï¼ˆç‚¹æ•°è¨ˆç®—è‡ªä½“ã«ã¯å½±éŸ¿ã—ã¾ã›ã‚“ï¼‰ã€‚
        </div>
      </div>

      <div class="card">
        <h1>é–“é•ã„å±¥æ­´ï¼ˆç›´è¿‘10ä»¶ï¼‰</h1>
        <div class="small">ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶å†…ã«ä¿å­˜ã—ã¾ã™ã€‚</div>
        <div class="log" id="mistakeLog" style="margin-top:10px;"></div>
      </div>
    </div>
  </div>

<script>
(() => {
  // =========================
  // 1) ã“ã“ãŒã€Œå•é¡Œï¼ˆç”»åƒï¼‰ã€ã®ç™»éŒ²å ´æ‰€
  // =========================
  // img: GitHub Pagesãªã‚‰ images/xxx.jpg ã®ã‚ˆã†ã«ç½®ã‘ã¾ã™
  // handText: ç”»åƒãŒãªã„å ´åˆã®ä»£æ›¿è¡¨ç¤ºï¼ˆç‰Œã®Unicodeãªã©ï¼‰
  // fu/han: ç‚¹æ•°è¨ˆç®—ã®å…¥åŠ›å€¤ï¼ˆç”»é¢ã«ã¯è¡¨ç¤ºã—ãªã„ï¼‰
  // doraIndicator: ç”»åƒã®æ¨ªã«å›ºå®šè¡¨ç¤ºï¼ˆæ–‡å­—ã§ã‚‚OKï¼‰
  const QUESTION_BANK = [
    {
      id: "q1",
      img: "", // ä¾‹: "images/hand1.jpg"
      handText: "ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰æ‰‹ç‰Œç”»åƒã‚’ images/hand1.jpg ã®ã‚ˆã†ã«ç½®ã„ã¦ img ã‚’æŒ‡å®šã—ã¦ãã ã•ã„",
      fu: 30, han: 2,
      doraIndicator: "ğŸ€™"
    },
    {
      id: "q2",
      img: "",
      handText: "ï¼ˆä¾‹ï¼‰ğŸ€‡ğŸ€ˆğŸ€‰ ğŸ€ŠğŸ€ŠğŸ€Š ğŸ€ŒğŸ€ğŸ€ ğŸ€™ğŸ€™ğŸ€™ ğŸ€…ğŸ€…",
      fu: 40, han: 3,
      doraIndicator: "ğŸ€"
    },
    {
      id: "q3",
      img: "",
      handText: "ï¼ˆä¾‹ï¼‰ğŸ€‘ğŸ€’ğŸ€“ ğŸ€”ğŸ€”ğŸ€” ğŸ€šğŸ€›ğŸ€œ ğŸ€ğŸ€ğŸ€ ğŸ€†ğŸ€†",
      fu: 25, han: 4,
      doraIndicator: "ğŸ€˜"
    }
  ];

  // ---------- Utilities ----------
  const ceil100 = (n) => Math.ceil(n / 100) * 100;
  const nowISO = () => new Date().toISOString();
  const pick = (arr) => arr[Math.floor(Math.random() * arr.length)];

  function escapeHtml(s){
    return String(s)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  function loadState(){
    try{
      const raw = localStorage.getItem("mj_quiz_img_v2");
      if(!raw) return null;
      return JSON.parse(raw);
    } catch { return null; }
  }
  function saveState(s){
    localStorage.setItem("mj_quiz_img_v2", JSON.stringify(s));
  }

  // ---------- State ----------
  const state = loadState() ?? { score: 0, total: 0, streak: 0, mistakes: [] };

  // ---------- DOM ----------
  const $ = (id) => document.getElementById(id);
  const elScore = $("score");
  const elTotal = $("total");
  const elStreak = $("streak");
  const elMistakeLog = $("mistakeLog");
  const elAnswer = $("answer");
  const elSubmit = $("submitBtn");
  const elNext = $("nextBtn");
  const elReset = $("resetBtn");
  const elResult = $("result");
  const elDetailBox = $("detailBox");
  const elDetail = $("detail");

  const elHandImg = $("handImg");
  const elHandFallback = $("handFallback");

  const elRoundWind = $("roundWind");
  const elDealerOrChild = $("dealerOrChild");
  const elWinType = $("winType");
  const elDoraIndicator = $("doraIndicator");

  function renderStats(){
    elScore.textContent = state.score;
    elTotal.textContent = state.total;
    elStreak.textContent = state.streak;
  }
  function renderMistakes(){
    const items = state.mistakes.slice(-10).reverse();
    if(items.length === 0){
      elMistakeLog.innerHTML = `<div class="small">ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</div>`;
      return;
    }
    elMistakeLog.innerHTML = items.map(m => `
      <div class="log-item">
        <div><b>${escapeHtml(m.q)}</b></div>
        <div class="small">ã‚ãªãŸï¼š${escapeHtml(m.your)} ï¼ æ­£è§£ï¼š<b>${escapeHtml(m.correct)}</b></div>
      </div>
    `).join("");
  }

  // ---------- Mahjong Points ----------
  function limitCategory(han, fu){
    // æ•°ãˆå½¹æº€ï¼ˆ13ç¿»ä»¥ä¸Šï¼‰
    if(han >= 13) return { type: "å½¹æº€", base: 8000, note: "æ•°ãˆå½¹æº€(13ç¿»ä»¥ä¸Š)" };
    if(han >= 11) return { type: "ä¸‰å€æº€", base: 6000, note: "11ã€œ12ç¿»" };
    if(han >= 8)  return { type: "å€æº€", base: 4000, note: "8ã€œ10ç¿»" };
    if(han >= 6)  return { type: "è·³æº€", base: 3000, note: "6ã€œ7ç¿»" };

    // æº€è²«æ¡ä»¶ï¼š5ç¿»ã€ã¾ãŸã¯4ç¿»40ç¬¦ä»¥ä¸Šã€ã¾ãŸã¯3ç¿»70ç¬¦ä»¥ä¸Š
    if(han >= 5) return { type: "æº€è²«", base: 2000, note: "5ç¿»" };
    if(han === 4 && fu >= 40) return { type: "æº€è²«", base: 2000, note: "4ç¿»40ç¬¦ä»¥ä¸Š" };
    if(han === 3 && fu >= 70) return { type: "æº€è²«", base: 2000, note: "3ç¿»70ç¬¦ä»¥ä¸Š" };
    return null;
  }

  function calcBasePoints(han, fu){
    const lim = limitCategory(han, fu);
    if(lim) return { base: lim.base, limit: lim };

    const base = fu * (2 ** (han + 2));
    if(base > 2000){
      return { base: 2000, limit: { type: "æº€è²«", base: 2000, note: "åŸºæœ¬ç‚¹ãŒ2000è¶…ã®ãŸã‚æº€è²«" } };
    }
    return { base, limit: null };
  }

  function calcPayments(han, fu, isDealer, isTsumo){
    const { base, limit } = calcBasePoints(han, fu);
    let detail = [];
    detail.push(`ç¬¦ãƒ»ç¿»ï¼š${fu}ç¬¦ ${han}ç¿»`);
    if(limit){
      detail.push(`ä¸Šé™ï¼š${limit.type}ï¼ˆ${limit.note}ï¼‰ â†’ åŸºæœ¬ç‚¹=${limit.base}`);
    } else {
      detail.push(`åŸºæœ¬ç‚¹ = ç¬¦ Ã— 2^(ç¿»+2) = ${fu} Ã— 2^(${han}+2) = ${base}`);
    }

    if(!isTsumo){
      const mult = isDealer ? 6 : 4;
      const raw = base * mult;
      const pay = ceil100(raw);
      detail.push(`ãƒ­ãƒ³å€ç‡ï¼šÃ—${mult}ï¼ˆ${isDealer ? "è¦ª" : "å­"}ï¼‰`);
      detail.push(`ç‚¹æ•° = ${base}Ã—${mult} = ${raw} â†’ 100ç‚¹å˜ä½åˆ‡ã‚Šä¸Šã’ â†’ ${pay}`);
      return { label: `${pay}`, canonical: { type:"ron", ron: pay }, detail: detail.join("\n") };
    } else {
      if(isDealer){
        const rawEach = base * 2;
        const each = ceil100(rawEach);
        detail.push(`ãƒ„ãƒ¢ï¼ˆè¦ªï¼‰ï¼šå„è‡ª = ${base}Ã—2 = ${rawEach} â†’ åˆ‡ã‚Šä¸Šã’ â†’ ${each}`);
        return { label: `${each}ã‚ªãƒ¼ãƒ«`, canonical: { type:"tsumo_dealer", each }, detail: detail.join("\n") };
      } else {
        const rawChild = base * 1;
        const rawDealer = base * 2;
        const childPay = ceil100(rawChild);
        const dealerPay = ceil100(rawDealer);
        detail.push(`ãƒ„ãƒ¢ï¼ˆå­ï¼‰ï¼šå­ = ${base}Ã—1 = ${rawChild} â†’ åˆ‡ã‚Šä¸Šã’ â†’ ${childPay}`);
        detail.push(`ãƒ„ãƒ¢ï¼ˆå­ï¼‰ï¼šè¦ª = ${base}Ã—2 = ${rawDealer} â†’ åˆ‡ã‚Šä¸Šã’ â†’ ${dealerPay}`);
        return { label: `${dealerPay}/${childPay}`, canonical: { type:"tsumo_child", dealerPay, childPay }, detail: detail.join("\n") };
      }
    }
  }

  // ---------- Answer Parse ----------
  function normalizeInput(s){
    return String(s).trim()
      .replaceAll(" ", "")
      .replaceAll("ã€€","")
      .replaceAll("ï¼","/")
      .replaceAll("å††","")
      .replaceAll(",","")
      .toLowerCase();
  }
  function parseAnswer(raw){
    const s = normalizeInput(raw);
    if(!s) return null;

    const mAll = s.match(/^(\d+)(?:ã‚ªãƒ¼ãƒ«|all)$/);
    if(mAll) return { type:"tsumo_dealer", each: parseInt(mAll[1],10) };

    const mSplit = s.match(/^(\d+)\/(\d+)$/);
    if(mSplit) return { type:"tsumo_child", dealerPay: parseInt(mSplit[1],10), childPay: parseInt(mSplit[2],10) };

    const mNum = s.match(/^\d+$/);
    if(mNum) return { type:"ron", ron: parseInt(s,10) };

    return { type:"unknown", raw:s };
  }
  function equalCanonical(a, b){
    if(!a || !b) return false;
    if(a.type !== b.type) return false;
    if(a.type === "ron") return a.ron === b.ron;
    if(a.type === "tsumo_dealer") return a.each === b.each;
    if(a.type === "tsumo_child") return a.dealerPay === b.dealerPay && a.childPay === b.childPay;
    return false;
  }

  // ---------- Quiz ----------
  const ROUND_WINDS = ["æ±å ´", "å—å ´"]; // ãƒ©ãƒ³ãƒ€ãƒ è¡¨ç¤º
  let current = null;
  let locked = false;

  function showHandImageOrFallback(q){
    if(q.img){
      elHandImg.src = q.img;
      elHandImg.style.display = "block";
      elHandFallback.style.display = "none";
      elHandImg.onerror = () => {
        elHandImg.style.display = "none";
        elHandFallback.style.display = "block";
        elHandFallback.textContent = q.handText || "ï¼ˆç”»åƒã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸï¼‰";
      };
    } else {
      elHandImg.style.display = "none";
      elHandFallback.style.display = "block";
      elHandFallback.textContent = q.handText || "ï¼ˆç”»åƒæœªè¨­å®šï¼‰";
    }
  }

  function makeQuestion(){
    if(!QUESTION_BANK.length) throw new Error("QUESTION_BANK ãŒç©ºã§ã™");
    const baseQ = pick(QUESTION_BANK);

    // æŒ‡å®šã©ãŠã‚Šãƒ©ãƒ³ãƒ€ãƒ è¨­å®š
    const round = pick(ROUND_WINDS);           // æ±å ´orå—å ´
    const isDealer = Math.random() < 0.5;      // è¦ªorå­
    const isTsumo = Math.random() < 0.5;       // ãƒ„ãƒ¢orãƒ­ãƒ³

    const calc = calcPayments(baseQ.han, baseQ.fu, isDealer, isTsumo);

    // è¡¨ç¤ºç”¨ãƒ©ãƒ™ãƒ«
    const dealerLabel = isDealer ? "è¦ª" : "å­";
    const winLabel = isTsumo ? "ãƒ„ãƒ¢" : "ãƒ­ãƒ³";

    // å±¥æ­´ç”¨ï¼ˆç¬¦ãƒ»ç¿»ã¯ç”»é¢ã«å‡ºã•ãªã„ãŒã€é–“é•ã„ãƒ­ã‚°ã¨è©³ç´°ã«ã¯æ®‹ã™ï¼‰
    const qText = `ã€${dealerLabel} / ${round} / ${winLabel} / ä¾›è¨—0 æœ¬å ´0 / ãƒ‰ãƒ©:${baseQ.doraIndicator} / (${baseQ.fu}ç¬¦${baseQ.han}ç¿»)ã€‘`;

    return {
      ...baseQ,
      round,
      isDealer,
      isTsumo,
      dealerLabel,
      winLabel,
      qText,
      correctLabel: calc.label,
      canonical: calc.canonical,
      detail: [
        qText,
        "",
        calc.detail
      ].join("\n")
    };
  }

  function renderQuestion(){
    current = makeQuestion();
    locked = false;

    showHandImageOrFallback(current);

    // ã‚µã‚¤ãƒ‰æƒ…å ±è¡¨ç¤ºï¼ˆç¬¦ãƒ»ç¿»ã¯è¡¨ç¤ºã—ãªã„ï¼‰
    elRoundWind.textContent = current.round;
    elDealerOrChild.textContent = current.dealerLabel;
    elWinType.textContent = current.winLabel;
    elDoraIndicator.textContent = current.doraIndicator || "-";

    // å…¥åŠ›/çµæœãƒªã‚»ãƒƒãƒˆ
    elAnswer.value = "";
    elAnswer.focus();
    elResult.innerHTML = "";
    elDetailBox.style.display = "none";
    elDetail.textContent = "";
    elSubmit.disabled = false;
    elNext.disabled = true;
  }

  function submit(){
    if(locked) return;
    const parsed = parseAnswer(elAnswer.value);
    if(!parsed || parsed.type === "unknown"){
      elResult.innerHTML = `<div class="ng">å…¥åŠ›å½¢å¼ãŒåˆã£ã¦ã„ã¾ã›ã‚“ã€‚</div>
      <div class="meta">ä¾‹ï¼šãƒ­ãƒ³â†’<b>3900</b> ï¼ å­ãƒ„ãƒ¢â†’<b>2000/1000</b> ï¼ è¦ªãƒ„ãƒ¢â†’<b>2000ã‚ªãƒ¼ãƒ«</b></div>`;
      return;
    }

    locked = true;
    elSubmit.disabled = true;
    elNext.disabled = false;

    state.total += 1;
    const ok = equalCanonical(parsed, current.canonical);

    if(ok){
      state.score += 1;
      state.streak += 1;
      elResult.innerHTML = `<div class="ok">æ­£è§£ï¼ âœ…ã€€æ­£è§£ï¼š<b>${escapeHtml(current.correctLabel)}</b></div>`;
    } else {
      state.streak = 0;
      const your = normalizeInput(elAnswer.value) || "(ç©º)";
      state.mistakes.push({
        ts: nowISO(),
        q: current.qText,
        correct: current.correctLabel,
        your: your
      });
      if(state.mistakes.length > 50) state.mistakes = state.mistakes.slice(-50);
      elResult.innerHTML = `<div class="ng">ä¸æ­£è§£ âŒã€€æ­£è§£ï¼š<b>${escapeHtml(current.correctLabel)}</b></div>`;
    }

    elDetailBox.style.display = "block";
    elDetail.textContent = current.detail;

    saveState(state);
    renderStats();
    renderMistakes();
  }

  function resetAll(){
    if(!confirm("ã‚¹ã‚³ã‚¢ã¨é–“é•ã„å±¥æ­´ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ")) return;
    state.score = 0;
    state.total = 0;
    state.streak = 0;
    state.mistakes = [];
    saveState(state);
    renderStats();
    renderMistakes();
    renderQuestion();
  }

  // ---------- Init ----------
  renderStats();
  renderMistakes();
  renderQuestion();

  elSubmit.addEventListener("click", submit);
  elNext.addEventListener("click", renderQuestion);
  elReset.addEventListener("click", resetAll);

  elAnswer.addEventListener("keydown", (e) => {
    if(e.key === "Enter"){
      if(!locked) submit();
      else renderQuestion();
    }
  });

  // è¿½åŠ ï¼šiOSãªã©ã§IMEçŠ¶æ…‹ãŒæ®‹ã‚‹å ´åˆãŒã‚ã‚‹ã®ã§ã€ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã«æœ«å°¾ã¸
  elAnswer.addEventListener("focus", () => {
    const v = elAnswer.value;
    elAnswer.value = "";
    elAnswer.value = v;
  });
})();
</script>
</body>
</html>
